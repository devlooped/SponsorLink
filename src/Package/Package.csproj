<Project Sdk="Microsoft.NET.Sdk">

  <PropertyGroup>
    <PackageId>Devlooped.SponsorLink</PackageId>
    <AssemblyName>Devlooped.SponsorLink</AssemblyName>
    <TargetFramework>netstandard2.0</TargetFramework>
    <CopyLocalLockFileAssemblies>true</CopyLocalLockFileAssemblies>
    <GenerateDocumentationFile>true</GenerateDocumentationFile>
    <PackBuildOutput>false</PackBuildOutput>
  </PropertyGroup>

  <ItemGroup>
    <PackageReference Include="NuGetizer" Version="0.9.1" />
    <PackageReference Include="Microsoft.CodeAnalysis.CSharp" Version="4.3.1" Pack="false" />
    <PackageReference Include="Obfuscar" Version="2.2.37" PrivateAssets="all" />
  </ItemGroup>

  <ItemGroup>
    <None Update="@(None)" CopyToOutputDirectory="PreserveNewest" />
    <PackageFile Include="$(MSBuildThisFileDirectory)_._" PackagePath="lib/netstandard2.0/_._" />
    <PackageFile Include="*.props;*.targets" PackagePath="buildTransitive\$(TargetFramework)\%(Filename)%(Extension)" />
  </ItemGroup>

  <Target Name="Obfuscate" AfterTargets="Build" DependsOnTargets="Build">
    <Exec Command="$(Obfuscar) $(MSBuildThisFileDirectory)Obfuscar.$(Configuration).xml" />
  </Target>

  <Target Name="AddObfuscated" BeforeTargets="GetPackageContents" DependsOnTargets="Obfuscate">
    <ItemGroup>
      <PackageFile Include="$(OutputPath)\$(TargetName).xml" PackFolder="lib" />
      <PackageFile Include="$(OutputPath)\obfuscated\$(TargetFileName)" PackFolder="lib" />
      <PackageFile Include="$(OutputPath)\obfuscated\$(TargetFileName)" PackFolder="analyzers/dotnet" />
    </ItemGroup>
  </Target>
  
</Project>
